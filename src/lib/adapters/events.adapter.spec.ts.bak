/**
 * Unit Tests: Events Adapter
 *
 * Tests transformation of event data from DB format to domain format.
 */

import { describe, it, expect } from 'vitest';
import { adaptEventFromDb } from './events.adapter';
import type { EventDB } from '$lib/types/db';

describe('Events Adapter', () => {
	describe('adaptEventFromDb', () => {
		it('should transform DB event to domain Event', () => {
			const dbEvent: EventDB = {
				id: '123e4567-e89b-12d3-a456-426614174000',
				id: '123e4567xe',
				name: 'Gran Fondo Valencia',
				description: 'Annual cycling event',
				date_time: '2024-06-15T09:00:00Z',
				year: 2024,
				city: 'Valencia',
				state: 'Valencia',
				country: 'Spain',
				event_status: 'AVAILABLE',
				is_public_visible: true,
				organization_id: 'org-123',
				created_by: 'user-123',
				created_at: '2024-01-01T00:00:00Z',
				updated_at: '2024-01-01T00:00:00Z'
			};

			const result = adaptEventFromDb(dbEvent);

			expect(result).toEqual({
				id: '123e4567xe', // id: first 10 chars of UUID with '-' replaced
				name: 'Gran Fondo Valencia',
				description: 'Annual cycling event',
				dateTime: '2024-06-15T09:00:00Z',
				year: 2024,
				city: 'Valencia',
				state: 'Valencia',
				country: 'Spain',
				eventStatus: 'AVAILABLE',
				isPublicVisible: true,
				organizationId: 'org-123', // Foreign keys are NOT transformed
				createdBy: 'user-123', // Foreign keys are NOT transformed
				createdAt: expect.any(String),
				updatedAt: expect.any(String)
			});
		});

		it('should handle null description', () => {
			const dbEvent: EventDB = {
				id: '123',
				id: '123',
				name: 'Test Event',
				description: null,
				date_time: '2024-01-01T00:00:00Z',
				year: 2024,
				city: 'City',
				state: 'State',
				country: 'Country',
				event_status: 'DRAFT',
				is_public_visible: false,
				organization_id: 'org-1',
				created_by: 'user-1',
				created_at: '2024-01-01T00:00:00Z',
				updated_at: '2024-01-01T00:00:00Z'
			};

			const result = adaptEventFromDb(dbEvent);

			expect(result.description).toBeNull();
		});

		it('should preserve event status enum', () => {
			const statuses = ['DRAFT', 'AVAILABLE', 'SOLD_OUT', 'ON_GOING', 'FINISHED'] as const;

			statuses.forEach((status) => {
				const dbEvent: EventDB = {
					id: '123',
					id: '123',
					name: 'Event',
					description: null,
					date_time: '2024-01-01T00:00:00Z',
					year: 2024,
					city: 'City',
					state: 'State',
					country: 'Country',
					event_status: status,
					is_public_visible: true,
					organization_id: 'org-1',
					created_by: 'user-1',
					created_at: '2024-01-01T00:00:00Z',
					updated_at: '2024-01-01T00:00:00Z'
				};

				const result = adaptEventFromDb(dbEvent);

				expect(result.eventStatus).toBe(status);
			});
		});
	});
});
